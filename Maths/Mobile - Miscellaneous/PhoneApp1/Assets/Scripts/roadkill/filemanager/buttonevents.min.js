var Roadkill;(function(n){(function(n){(function(t){var i=function(){function i(){this._htmlBuilder=new t.HtmlBuilder,this._ajaxRequest=new t.AjaxRequest}return i.prototype.bind=function(){var n=this;$(document).on("click","#addfolderbtn",{instance:n},this.addFolderInput);$(document).on("click","#deletefolderbtn",{instance:n},this.deleteFolder);$(document).on("click","#deletefilebtn",{instance:n},this.deleteFile);$(document).on("keyup","#newfolderinput",{instance:n},this.addNewFolder);$(document).on("click","#newfoldercancel",{instance:n},this.cancelNewFolder)},i.prototype.deleteFolder=function(i){var f=i.data.instance,e=$("tr.select"),r=e.attr("data-urlpath"),u;t.Util.IsStringNullOrEmpty(r)||(u=t.Util.FormatString(ROADKILL_FILEMANAGER_DELETE_CONFIRM,r),n.Dialogs.confirm(u,function(n){if(n){var i=function(n){var i,u,f;n.status=="ok"?(i=$("ul.navigator li:last-child"),u=i.attr("data-urlpath"),t.TableEvents.update(u,!1),toastr.info(ROADKILL_FILEMANAGER_FOLDER_DELETED_SUCCESS)):(f=t.Util.FormatString(ROADKILL_FILEMANAGER_DELETE_ERROR,r),toastr.error(f+" :<br/>"+n.message))};f._ajaxRequest.deleteFolder(r,i)}}))},i.prototype.deleteFile=function(i){var f=i.data.instance,r=$("tr.select");if(r.length>0&&r.attr("data-itemtype")=="file"){var e=t.TableEvents.getCurrentPath(),u=$("td.file",r).text(),o=t.Util.FormatString(ROADKILL_FILEMANAGER_DELETE_CONFIRM,u);n.Dialogs.confirm(o,function(n){if(n){var i=function(n){if(n.status=="ok")$(r).remove(),toastr.info("ROADKILL_FILEMANAGER_FILE_DELETED_SUCCESS");else{var i=t.Util.FormatString(ROADKILL_FILEMANAGER_DELETE_ERROR,u);toastr.error(i+" :<br/>"+n.message)}};f._ajaxRequest.deleteFile(u,e,i)}})}},i.prototype.addFolderInput=function(n){var r=n.data.instance,t,i;if($("tr#newfolderrow").length>0){$("#newfolderinput").focus();return}t=$("table#files tr[data-itemtype=folder]"),i=r._htmlBuilder.getNewFolder(),t.length>0?(t=t.last(),$(i).insertAfter(t)):$("table#files").append(i),$("#newfolderinput").focus()},i.prototype.addNewFolder=function(n){var i=n.data.instance,r,u;if(n.which==0||n.which==27)i.cancelNewFolder();else if(n.which==13){if(r=$("#newfolderinput").val(),r.replace(/\s/g,"").length==0){i.cancelNewFolder();return}u=function(n){if(n.status=="error"){toastr.error(ROADKILL_FILEMANAGER_ERROR_CREATEFOLDER+":<br/>"+n.message);return}var i=$("ul.navigator li:last-child");t.TableEvents.update(i.attr("data-urlpath")),t.BreadCrumbTrail.removeLastItem(),$("tr#newfolderrow").remove()},i._ajaxRequest.newFolder(t.TableEvents.getCurrentPath(),r,u)}},i.prototype.cancelNewFolder=function(){$("tr#newfolderrow").remove()},i}();t.ButtonEvents=i})(n.FileManager||(n.FileManager={}));var t=n.FileManager})(n.Site||(n.Site={}));var t=n.Site})(Roadkill||(Roadkill={}))